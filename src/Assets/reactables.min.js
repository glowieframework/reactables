document.addEventListener("DOMContentLoaded",()=>{class ReactablesComponent{el;id;checksum;data;baseUrl;files;constructor(el){this.el=el;let data=JSON.parse(this.el.getAttribute("r-data"));this.id=this.el.getAttribute("r-id"),this.name=data.name,this.data=JSON.parse(data.data),this.checksum=data.checksum,this.baseUrl=data.base_url,this.files={},this.removeAttrs(),this.bind(!0),this.toggleLoads(),this.runInits()}find(query){return Array.from(this.el.querySelectorAll(query)).filter(el=>!el.closest("[r-id]"))}toggleLoads(ready=!0){ready?(this.find("[r-loading]").forEach(el=>{el.style.display="none"}),this.find("[r-ready]").forEach(el=>{let attr=el.getAttribute("r-ready");el.style.display=attr.length?attr:"inline-block"}),this.find("[r-loading-class]").forEach(el=>{el.classList.remove(el.getAttribute("r-loading-class"))}),this.find("[r-ready-class]").forEach(el=>{el.classList.add(el.getAttribute("r-ready-class"))}),this.find("[r-loading-attr]").forEach(el=>{el.removeAttribute(el.getAttribute("r-loading-attr"))}),this.find("[r-ready-attr]").forEach(el=>{el.setAttribute(el.getAttribute("r-loading-attr"),"true")})):(this.find("[r-loading]").forEach(el=>{let attr=el.getAttribute("r-loading");el.style.display=attr.length?attr:"inline-block"}),this.find("[r-ready]").forEach(el=>{el.style.display="none"}),this.find("[r-loading-class]").forEach(el=>{el.classList.add(el.getAttribute("r-loading-class"))}),this.find("[r-ready-class]").forEach(el=>{el.classList.remove(el.getAttribute("r-ready-class"))}),this.find("[r-loading-attr]").forEach(el=>{el.setAttribute(el.getAttribute("r-loading-attr"),"true")}),this.find("[r-ready-attr]").forEach(el=>{el.removeAttribute(el.getAttribute("r-loading-attr"))}))}removeAttrs(){this.el.removeAttribute("r-id"),this.el.removeAttribute("r-data")}bind(listen=!1){this.bindModels(listen),this.bindEvents(listen),this.bindRepeats(listen)}bindModels(listen=!1){this.find("input[type=text][r-model], input[type=date][r-model], input[type=datetime-local][r-model], input[type=email][r-model], input[type=number][r-model], input[type=month][r-model], input[type=password][r-model], input[type=range][r-model], input[type=search][r-model], input[type=tel][r-model], input[type=time][r-model], input[type=url][r-model], input[type=color][r-model], input[type=week][r-model], textarea[r-model]").forEach(model=>{let name=model.getAttribute("r-model"),lazy=model.hasAttribute("r-lazy"),debounce=model.getAttribute("r-debounce"),debounceTimeout=null,value=this.data[name];void 0!==value&&(model.value=value),listen&&model.addEventListener("input",()=>{this.data[name]=model.value,lazy||(debounce?(debounceTimeout&&clearTimeout(debounceTimeout),debounceTimeout=setTimeout(()=>{this.refresh()},debounce)):this.refresh())}),model.removeAttribute("r-model"),model.removeAttribute("r-lazy"),model.removeAttribute("r-debounce")}),this.find("input[type=checkbox][r-model], input[type=radio][r-model]").forEach(model=>{let name=model.getAttribute("r-model"),lazy=model.hasAttribute("r-lazy"),debounce=model.getAttribute("r-debounce"),debounceTimeout=null,rawName=name.replace("[]",""),custom=model.getAttribute("value"),value=this.data[rawName];name.endsWith("[]")?Array.isArray(value)&&custom&&value.some(v=>v==custom)&&(model.checked=!0):void 0!==value&&(custom?value==custom&&(model.checked=!0):model.checked=value),listen&&model.addEventListener("input",()=>{if(name.endsWith("[]")){if(Array.isArray(this.data[rawName])||(this.data[rawName]=[]),custom)if(model.checked)this.data[rawName].push(custom);else{let idx=this.data[rawName].findIndex(v=>v==custom);-1!==idx&&this.data[rawName].splice(idx,1)}}else this.data[name]=custom?!!model.checked&&custom:model.checked;lazy||(debounce?(debounceTimeout&&clearTimeout(debounceTimeout),debounceTimeout=setTimeout(()=>{this.refresh()},debounce)):this.refresh())}),model.removeAttribute("r-model"),model.removeAttribute("r-lazy"),model.removeAttribute("r-debounce")}),this.find("select[r-model]").forEach(model=>{let name=model.getAttribute("r-model"),lazy=model.hasAttribute("r-lazy"),debounce=model.getAttribute("r-debounce"),debounceTimeout=null,rawName=name.replace("[]",""),value=this.data[rawName];name.endsWith("[]")?Array.isArray(value)&&Array.from(model.options).forEach(option=>{value.some(v=>v==option.value)&&(option.selected=!0)}):void 0!==value&&(model.value=value),listen&&model.addEventListener("input",()=>{name.endsWith("[]")?(this.data[rawName]=[],Array.from(model.selectedOptions).forEach(option=>{this.data[rawName].push(option.value)})):this.data[rawName]=model.value,lazy||(debounce?(debounceTimeout&&clearTimeout(debounceTimeout),debounceTimeout=setTimeout(()=>{this.refresh()},debounce)):this.refresh())})}),this.find("input[type=file][r-model]").forEach(model=>{let name=model.getAttribute("r-model"),lazy=model.hasAttribute("r-lazy"),debounce=model.getAttribute("r-debounce"),debounceTimeout=null;listen&&model.addEventListener("input",()=>{this.files[name]=model.files,lazy||(debounce?(debounceTimeout&&clearTimeout(debounceTimeout),debounceTimeout=setTimeout(()=>{this.refresh()},debounce)):this.refresh())}),model.removeAttribute("r-model"),model.removeAttribute("r-lazy"),model.removeAttribute("r-debounce")})}bindEvents(listen=!1){this.find("[r-click]").forEach(el=>{let value=el.getAttribute("r-click"),prevent=el.hasAttribute("r-prevent");listen&&el.addEventListener("click",event=>{prevent&&event.preventDefault(),this.refresh(value)}),el.removeAttribute("r-click"),el.removeAttribute("r-prevent")}),this.find("[r-submit]").forEach(el=>{let value=el.getAttribute("r-submit"),prevent=el.hasAttribute("r-prevent");listen&&el.addEventListener("submit",event=>{prevent&&event.preventDefault(),this.refresh(value)}),el.removeAttribute("r-submit"),el.removeAttribute("r-prevent")}),this.find("[r-focus]").forEach(el=>{let value=el.getAttribute("r-focus"),prevent=el.hasAttribute("r-prevent");listen&&el.addEventListener("focus",event=>{prevent&&event.preventDefault(),this.refresh(value)}),el.removeAttribute("r-focus"),el.removeAttribute("r-prevent")}),this.find("[r-blur]").forEach(el=>{let value=el.getAttribute("r-blur"),prevent=el.hasAttribute("r-prevent");listen&&el.addEventListener("blur",event=>{prevent&&event.preventDefault(),this.refresh(value)}),el.removeAttribute("r-blur"),el.removeAttribute("r-prevent")}),this.find("[r-hover]").forEach(el=>{let value=el.getAttribute("r-hover"),prevent=el.hasAttribute("r-prevent");listen&&el.addEventListener("mouseover",event=>{prevent&&event.preventDefault(),this.refresh(value)}),el.removeAttribute("r-hover"),el.removeAttribute("r-prevent")}),this.find("[r-leave]").forEach(el=>{let value=el.getAttribute("r-leave"),prevent=el.hasAttribute("r-prevent");listen&&el.addEventListener("mouseleave",event=>{prevent&&event.preventDefault(),this.refresh(value)}),el.removeAttribute("r-leave"),el.removeAttribute("r-prevent")}),this.find("[r-enter]").forEach(el=>{let value=el.getAttribute("r-enter"),prevent=el.hasAttribute("r-prevent");listen&&el.addEventListener("keydown",event=>{13===event.keyCode&&(prevent&&event.preventDefault(),this.refresh(value))}),el.removeAttribute("r-enter"),el.removeAttribute("r-prevent")}),this.find("[r-tab]").forEach(el=>{let value=el.getAttribute("r-tab"),prevent=el.hasAttribute("r-prevent");listen&&el.addEventListener("keydown",event=>{9===event.keyCode&&(prevent&&event.preventDefault(),this.refresh(value))}),el.removeAttribute("r-tab"),el.removeAttribute("r-prevent")})}bindRepeats(listen=!1){this.find("[r-repeat][r-interval]").forEach(el=>{let value=el.getAttribute("r-repeat"),interval=el.getAttribute("r-interval"),repeatInterval=null;listen&&(repeatInterval&&clearInterval(repeatInterval),repeatInterval=setInterval(()=>{this.refresh(value)},interval)),el.removeAttribute("r-repeat"),el.removeAttribute("r-interval")})}runInits(){this.find("[r-init]").forEach(el=>{let value=el.getAttribute("r-init"),timeout=el.getAttribute("r-timeout"),timeoutInterval=null;timeout?(timeoutInterval&&clearTimeout(timeoutInterval),timeoutInterval=setTimeout(()=>{this.refresh(value)},timeout)):this.refresh(value),el.removeAttribute("r-init"),el.removeAttribute("r-timeout")})}removeInits(){this.find("[r-init]").forEach(el=>{el.removeAttribute("r-init"),el.removeAttribute("r-timeout")})}parseQuery(query){let url=window.location.pathname;query&&query.length&&(url+="?"+query),window.location.hash&&(url+=window.location.hash),url!=window.location.href&&window.history.pushState({},"",url)}refresh(method=null){this.toggleLoads(!1);let data=new FormData;data.append("id",this.id),data.append("name",this.name),data.append("data",JSON.stringify(this.data)),data.append("checksum",this.checksum),method&&data.append("method",method);for(let key in this.files)Array.from(this.files[key]).forEach(file=>{data.append(key+"[]",file)});let xhr=new XMLHttpRequest,component=this;xhr.responseType="text",xhr.open("POST",this.baseUrl+"reactables/component",!0),xhr.send(data),xhr.onload=function(){if(200==xhr.status){let response=JSON.parse(xhr.responseText);if(response.redirect)return window.location=response.redirect;morphdom(component.el,response.html),component.data=JSON.parse(response.data),component.files={},component.removeAttrs(),component.bind(),component.parseQuery(response.query),component.toggleLoads(),component.removeInits()}else 403==xhr.status?document.reactables.expiredHandler?document.reactables.expiredHandler(xhr.responseText,xhr.status):window.reactables.showExpired():xhr.onerror()},xhr.onerror=function(){window.reactables.errorHandler?window.reactables.errorHandler(xhr.responseText,xhr.status):window.reactables.showError(xhr.responseText)}}}class Reactables{components=[];errorHandler=null;expireHandler=null;init(){document.querySelectorAll("[r-id]").forEach(el=>{this.components.push(new ReactablesComponent(el))});let ready=new Event("reactables-ready");document.dispatchEvent(ready)}find(id){return this.components.find(c=>c.id==id)}findName(name){return this.components.filter(c=>c.name==name)}onError(callback){this.errorHandler=callback}onExpired(callback){this.expireHandler=callback}showError(error){let errorContainer=document.createElement("div");errorContainer.style.cssText="position:fixed;inset:0;width:100vw;height:100vh;z-index:999999;background:rgba(0,0,0,.7);overflow:auto;",errorContainer.innerHTML=error,document.body.appendChild(errorContainer)}showExpired(){confirm("This page has expired.\nWould you like to refresh the page?")&&window.location.reload()}}window.reactables?console.error("[Reactables] You don't neet to included the assets more than once!"):(window.reactables=new Reactables,window.reactables.init())});