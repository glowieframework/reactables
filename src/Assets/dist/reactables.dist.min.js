!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).morphdom=t()}(this,(function(){"use strict";var e;function t(e,...t){if("function"==typeof t[0].hasAttribute)return e(...t)}var r="undefined"==typeof document?void 0:document,i=!!r&&"content"in r.createElement("template"),n=!!r&&r.createRange&&"createContextualFragment"in r.createRange();function o(t){return t=t.trim(),i?function(e){var t=r.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(t):n?function(t){return e||(e=r.createRange()).selectNode(r.body),e.createContextualFragment(t).childNodes[0]}(t):function(e){var t=r.createElement("body");return t.innerHTML=e,t.childNodes[0]}(t)}function a(e,t){var r,i,n=e.nodeName,o=t.nodeName;return n===o||(r=n.charCodeAt(0),i=o.charCodeAt(0),r<=90&&i>=97?n===o.toUpperCase():i<=90&&r>=97&&o===n.toUpperCase())}function s(e,t,r){e[r]!==t[r]&&(e[r]=t[r],e[r]?e.setAttribute(r,""):e.removeAttribute(r))}var d={OPTION:function(e,t){var r=e.parentNode;if(r){var i=r.nodeName.toUpperCase();"OPTGROUP"===i&&(i=(r=r.parentNode)&&r.nodeName.toUpperCase()),"SELECT"!==i||r.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),r.selectedIndex=-1)}s(e,t,"selected")},INPUT:function(e,t){s(e,t,"checked"),s(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var r=t.value;e.value!==r&&(e.value=r);var i=e.firstChild;if(i){var n=i.nodeValue;if(n==r||!r&&n==e.placeholder)return;i.nodeValue=r}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var r,i,n=-1,o=0,a=e.firstChild;a;)if("OPTGROUP"===(i=a.nodeName&&a.nodeName.toUpperCase()))a=(r=a).firstChild;else{if("OPTION"===i){if(a.hasAttribute("selected")){n=o;break}o++}!(a=a.nextSibling)&&r&&(a=r.nextSibling,r=null)}e.selectedIndex=n}}};function l(){}function u(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var c=function(e){return function(i,n,s){if(s||(s={}),"string"==typeof n)if("#document"===i.nodeName||"HTML"===i.nodeName||"BODY"===i.nodeName){var c=n;(n=r.createElement("html")).innerHTML=c}else n=o(n);else 11===n.nodeType&&(n=n.firstElementChild);var f=s.getNodeKey||u,h=s.onBeforeNodeAdded||l,m=s.onNodeAdded||l,p=s.onBeforeElUpdated||l,b=s.onElUpdated||l,v=s.onBeforeNodeDiscarded||l,E=s.onNodeDiscarded||l,A=s.onBeforeElChildrenUpdated||l,g=!0===s.childrenOnly,y=Object.create(null),w=[];function N(e){w.push(e)}function R(e,r){if(1===e.nodeType)for(var i=e.firstChild;i;){var n=void 0;r&&(n=t(f,i))?N(n):(t(E,i),i.firstChild&&R(i,r)),i=i.nextSibling}}function T(e,r,i){!1!==t(v,e)&&(r&&r.removeChild(e),t(E,e),R(e,i))}function x(e){if(t(m,e),!e.skipAddingChildren)for(var r=e.firstChild;r;){var i=r.nextSibling,n=t(f,r);if(n){var o=y[n];o&&a(r,o)?(r.parentNode.replaceChild(o,r),C(o,r)):x(r)}else x(r);r=i}}function C(i,n,o){var s=t(f,n);if(s&&delete y[s],!o){if(!1===t(p,i,n))return;if(i.skipElUpdatingButStillUpdateChildren||e(i,n),t(b,i),!1===t(A,i,n))return}"TEXTAREA"!==i.nodeName?function(e,i){var n,o,s,l,u,c=i.firstChild,m=e.firstChild;e:for(;c;){for(l=c.nextSibling,n=t(f,c);m;){if(s=m.nextSibling,c.isSameNode&&c.isSameNode(m)){c=l,m=s;continue e}o=t(f,m);var p=m.nodeType,b=void 0;if(p===c.nodeType&&(1===p?(n?n!==o&&((u=y[n])?s===u?b=!1:(e.insertBefore(u,m),o?N(o):T(m,e,!0),m=u):b=!1):o&&(b=!1),(b=!1!==b&&a(m,c))&&(!c.isEqualNode(m)&&c.nextElementSibling&&c.nextElementSibling.isEqualNode(m)?b=!1:C(m,c))):3!==p&&8!=p||(b=!0,m.nodeValue!==c.nodeValue&&(m.nodeValue=c.nodeValue))),b){c=l,m=s;continue e}if(c.nextElementSibling&&c.nextElementSibling.isEqualNode(m)){const t=c.cloneNode(!0);e.insertBefore(t,m),x(t),c=c.nextElementSibling.nextSibling,m=s;continue e}o?N(o):T(m,e,!0),m=s}if(n&&(u=y[n])&&a(u,c))e.appendChild(u),C(u,c);else{var v=t(h,c);!1!==v&&(v&&(c=v),c.actualize&&(c=c.actualize(e.ownerDocument||r)),e.appendChild(c),x(c))}c=l,m=s}!function(e,r,i){for(;r;){var n=r.nextSibling;(i=t(f,r))?N(i):T(r,e,!0),r=n}}(e,m,o);var E=d[e.nodeName];E&&E(e,i)}(i,n):i.innerHTML!=n.innerHTML&&d.TEXTAREA(i,n)}!function e(r){if(1===r.nodeType||11===r.nodeType)for(var i=r.firstChild;i;){var n=t(f,i);n&&(y[n]=i),e(i),i=i.nextSibling}}(i);var L,S,k=i,H=k.nodeType,D=n.nodeType;if(!g)if(1===H)1===D?a(i,n)||(t(E,i),k=function(e,t){for(var r=e.firstChild;r;){var i=r.nextSibling;t.appendChild(r),r=i}return t}(i,(L=n.nodeName,(S=n.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==S?r.createElementNS(S,L):r.createElement(L)))):k=n;else if(3===H||8===H){if(D===H)return k.nodeValue!==n.nodeValue&&(k.nodeValue=n.nodeValue),k;k=n}if(k===n)t(E,i);else{if(n.isSameNode&&n.isSameNode(k))return;if(C(k,n,g),w)for(var I=0,V=w.length;I<V;I++){var B=y[w[I]];B&&T(B,B.parentNode,!1)}}return!g&&k!==i&&i.parentNode&&(k.actualize&&(k=k.actualize(i.ownerDocument||r)),i.parentNode.replaceChild(k,i)),k}}((function(e,t){var r,i,n,o,a=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var s=a.length-1;s>=0;s--)i=(r=a[s]).name,n=r.namespaceURI,o=r.value,n?(i=r.localName||i,e.getAttributeNS(n,i)!==o&&("xmlns"===r.prefix&&(i=r.name),e.setAttributeNS(n,i,o))):e.getAttribute(i)!==o&&e.setAttribute(i,o);for(var d=e.attributes,l=d.length-1;l>=0;l--)i=(r=d[l]).name,(n=r.namespaceURI)?(i=r.localName||i,t.hasAttributeNS(n,i)||e.removeAttributeNS(n,i)):t.hasAttribute(i)||e.removeAttribute(i)}}));return c})),document.addEventListener("DOMContentLoaded",(()=>{class e{el;id;name;checksum;data;baseUrl;route;files={};constructor(e){this.el=e;let t=JSON.parse(this.el.getAttribute("r:data"));this.id=this.el.getAttribute("r:id"),this.name=t.name,this.data=JSON.parse(t.data),this.checksum=t.checksum,this.baseUrl=t.base_url,this.route=t.route,this.files={},this.removeAttrs(),this.bind(),this.parseNavigateLinks(),this.toggleLoads(),this.runInits()}find(e){return Array.from(this.el.querySelectorAll(e)).filter((e=>e.closest("[r\\:id]")===this.el))}toggleLoads(e=!0){e?(this.find("[r\\:loading]").forEach((e=>{e.style.display="none"})),this.find("[r\\:ready]").forEach((e=>{let t=e.getAttribute("r:ready");e.style.display=t.length?t:"inline-block"})),this.find("[r\\:loading-class]").forEach((e=>{e.classList.remove(e.getAttribute("r:loading-class"))})),this.find("[r\\:ready-class]").forEach((e=>{e.classList.add(e.getAttribute("r:ready-class"))})),this.find("[r\\:loading-attr]").forEach((e=>{e.removeAttribute(e.getAttribute("r:loading-attr"))})),this.find("[r\\:ready-attr]").forEach((e=>{e.setAttribute(e.getAttribute("r:loading-attr"),"true")}))):(this.find("[r\\:loading]").forEach((e=>{let t=e.getAttribute("r:loading");e.style.display=t.length?t:"inline-block"})),this.find("[r\\:ready]").forEach((e=>{e.style.display="none"})),this.find("[r\\:loading-class]").forEach((e=>{e.classList.add(e.getAttribute("r:loading-class"))})),this.find("[r\\:ready-class]").forEach((e=>{e.classList.remove(e.getAttribute("r:ready-class"))})),this.find("[r\\:loading-attr]").forEach((e=>{e.setAttribute(e.getAttribute("r:loading-attr"),"true")})),this.find("[r\\:ready-attr]").forEach((e=>{e.removeAttribute(e.getAttribute("r:loading-attr"))})))}removeAttrs(){this.el.removeAttribute("r:data")}bind(){this.bindModels(),this.bindEvents(),this.bindRepeats()}bindModels(){this.find("input[type=text][r\\:model], input[type=date][r\\:model], input[type=datetime-local][r\\:model], input[type=email][r\\:model], input[type=number][r\\:model], input[type=month][r\\:model], input[type=password][r\\:model], input[type=range][r\\:model], input[type=search][r\\:model], input[type=tel][r\\:model], input[type=time][r\\:model], input[type=url][r\\:model], input[type=color][r\\:model], input[type=week][r\\:model], textarea[r\\:model]").forEach((e=>{const t=e.getAttribute("r:model").trim(),r=e.hasAttribute("r:lazy"),i=e.getAttribute("r:debounce")||250,n=this.getValueDotNotation(this.data,t);void 0!==n&&(e.value=n),e.removeEventListener("input",e.listenerRef),e.listenerRef=()=>{this.setValueDotNotation(this.data,t,e.value),r||(i?(e.timeoutRef&&clearTimeout(e.timeoutRef),e.timeoutRef=setTimeout((()=>{window.reactables.refresh(this,e)}),i)):window.reactables.refresh(this,e))},e.addEventListener("input",e.listenerRef),e.removeAttribute("r:model"),e.removeAttribute("r:lazy"),e.removeAttribute("r:debounce")})),this.find("input[type=checkbox][r\\:model], input[type=radio][r\\:model]").forEach((e=>{const t=e.getAttribute("r:model").trim(),r=e.hasAttribute("r:lazy"),i=e.getAttribute("r:debounce"),n=t.replace("[]",""),o=e.getAttribute("value"),a=this.getValueDotNotation(this.data,n);t.endsWith("[]")?Array.isArray(a)&&o&&a.some((e=>e==o))&&(e.checked=!0):void 0!==a&&(o?a==o&&(e.checked=!0):e.checked=a),e.removeEventListener("input",e.listenerRef),e.listenerRef=()=>{if(t.endsWith("[]")){if(Array.isArray(a)||(a=[]),o)if(e.checked)a.push(o);else{let e=a.findIndex((e=>e==o));-1!==e&&a.splice(e,1)}this.setValueDotNotation(this.data,n,a)}else o?this.setValueDotNotation(this.data,t,!!e.checked&&o):this.setValueDotNotation(this.data,t,e.checked);r||(i?(e.timeoutRef&&clearTimeout(e.timeoutRef),e.timeoutRef=setTimeout((()=>{window.reactables.refresh(this,e)}),i)):window.reactables.refresh(this,e))},e.addEventListener("input",e.listenerRef),e.removeAttribute("r:model"),e.removeAttribute("r:lazy"),e.removeAttribute("r:debounce")})),this.find("select[r\\:model]").forEach((e=>{const t=e.getAttribute("r:model").trim(),r=e.hasAttribute("r:lazy"),i=e.getAttribute("r:debounce"),n=t.replace("[]",""),o=this.getValueDotNotation(this.data,n);t.endsWith("[]")?Array.isArray(o)&&Array.from(e.options).forEach((e=>{o.some((t=>t==e.value))&&(e.selected=!0)})):void 0!==o&&(e.value=o),e.removeEventListener("input",e.listenerRef),e.listenerRef=()=>{if(t.endsWith("[]")){let t=[];Array.from(e.selectedOptions).forEach((e=>{t.push(e.value)})),this.setValueDotNotation(this.data,n,t)}else this.setValueDotNotation(this.data,n,e.value);r||(i?(e.timeoutRef&&clearTimeout(e.timeoutRef),e.timeoutRef=setTimeout((()=>{window.reactables.refresh(this,e)}),i)):window.reactables.refresh(this,e))},e.addEventListener("input",e.listenerRef),e.removeAttribute("r:model"),e.removeAttribute("r:lazy"),e.removeAttribute("r:debounce")})),this.find("input[type=file][r\\:model]").forEach((e=>{const t=e.getAttribute("r:model").trim(),r=e.hasAttribute("r:lazy"),i=e.getAttribute("r:debounce");e.removeEventListener("input",e.listenerRef),e.listenerRef=()=>{this.files[t]=e.files,r||(i?(e.timeoutRef&&clearTimeout(e.timeoutRef),e.timeoutRef=setTimeout((()=>{window.reactables.refresh(this,e)}),i)):window.reactables.refresh(this,e))},e.addEventListener("input",e.listenerRef),e.removeAttribute("r:model"),e.removeAttribute("r:lazy"),e.removeAttribute("r:debounce")}))}getValueDotNotation(e,t){return t.split(".").reduce(((e,t)=>e[t]),e)}setValueDotNotation(e,t,r){if(Array.isArray(t)||(t=t.split(".")),1!==t.length)return e[t[0]]||(e[t[0]]={}),this.setValueDotNotation(e[t[0]],t.slice(1),r);e[t[0]]=r}bindEvents(){this.find("[r\\:submit]").forEach((e=>{this.defaultEventBinder(e,"submit","r:submit")})),this.find("[r\\:change]").forEach((e=>{this.defaultEventBinder(e,"change","r:change")})),this.find("[r\\:focus]").forEach((e=>{this.defaultEventBinder(e,"focus","r:focus")})),this.find("[r\\:blur]").forEach((e=>{this.defaultEventBinder(e,"blur","r:blur")})),this.find("[r\\:click]").forEach((e=>{this.defaultEventBinder(e,"click","r:click")})),this.find("[r\\:hover]").forEach((e=>{this.defaultEventBinder(e,"mouseover","r:hover")})),this.find("[r\\:move]").forEach((e=>{this.defaultEventBinder(e,"mousemove","r:move")})),this.find("[r\\:leave]").forEach((e=>{this.defaultEventBinder(e,"mouseleave","r:leave")})),this.find("[r\\:enter]").forEach((e=>{this.defaultEventBinder(e,"keydown","r:enter","Enter")})),this.find("[r\\:tab]").forEach((e=>{this.defaultEventBinder(e,"keydown","r:tab","Tab")})),this.find("[r\\:esc]").forEach((e=>{this.defaultEventBinder(e,"keydown","r:esc","Escape")}))}defaultEventBinder(e,t,r,i=!1){const n=e.getAttribute(r).trim(),o=e.hasAttribute("r:follow"),a=e.getAttribute("r:debounce"),s=e.getAttribute("r:confirm"),d=t+"Ref";e.removeEventListener(t,e[d]),e[d]=r=>{if(!i||r.key===i){if(s&&!window.confirm(s))return r.preventDefault();if(o||r.preventDefault(),a){const r=t+"DebounceRef";e[r]&&clearTimeout(e[r]),e[r]=setTimeout((()=>{window.reactables.refresh(this,e,n)}),a)}else window.reactables.refresh(this,e,n)}},e.addEventListener(t,e[d]),e.removeAttribute(r),e.removeAttribute("r:follow"),e.removeAttribute("r:debounce"),e.removeAttribute("r:confirm")}bindRepeats(){this.find("[r\\:repeat][r\\:interval]").forEach((e=>{const t=e.getAttribute("r:repeat").trim(),r=e.getAttribute("r:interval"),i=e.getAttribute("r:timeout");i?(e.repeatTimeoutRef&&clearTimeout(e.repeatTimeoutRef),e.repeatTimeoutRef=setTimeout((()=>{e.repeatIntervalRef&&clearInterval(e.repeatIntervalRef),e.repeatIntervalRef=setInterval((()=>{window.reactables.refresh(this,e,t)}),r)}),i)):(e.repeatIntervalRef&&clearInterval(e.repeatIntervalRef),e.repeatIntervalRef=setInterval((()=>{window.reactables.refresh(this,e,t)}),r)),e.removeAttribute("r:repeat"),e.removeAttribute("r:interval"),e.removeAttribute("r:timeout")}))}runInits(){this.find("[r\\:init]").forEach((e=>{const t=e.getAttribute("r:init").trim(),r=e.getAttribute("r:timeout");r?(e.initTimeoutRef&&clearTimeout(e.initTimeoutRef),e.initTimeoutRef=setTimeout((()=>{window.reactables.refresh(this,e,t)}),r)):window.reactables.refresh(this,e,t),e.removeAttribute("r:init"),e.removeAttribute("r:timeout")}))}removeInits(){this.find("[r\\:init]").forEach((e=>{e.removeAttribute("r:init"),e.removeAttribute("r:timeout")}))}parseQuery(e){let t=location.pathname;e&&e.length&&(t+="?"+e),location.hash&&(t+=location.hash),t!=location.href&&history.pushState({},"",t)}dispatchEvents(e){e&&e.length&&e.forEach((e=>{window.reactables.listeners[e.name]&&window.reactables.listeners[e.name](...e.params)}))}parseNavigateLinks(){this.find("[r\\:navigate]").forEach((e=>{let t=e.getAttribute("href").trim();e.removeEventListener("click",e.navigateRef),e.navigateRef=e=>{e.preventDefault(),window.reactables.navigate(t)},e.addEventListener("click",e.navigateRef),e.removeAttribute("r:navigate")}))}}window.reactables?console.error("[Reactables] You don't neet to included the assets more than once!"):(window.reactables=new class{components=[];listeners={};errorHandler;expiredHandler;overflow;init(){this.components=[],document.querySelectorAll("[r\\:id]").forEach((t=>{this.components.push(new e(t))}));let t=new Event("reactables-ready");document.dispatchEvent(t)}all(){return this.components}find(e){return this.components.find((t=>t.id==e))}on(e,t){this.listeners[e]=t}onError(e){this.errorHandler=e}onPageExpired(e){this.expiredHandler=e}showError(e){let t=document.createElement("html");t.innerHTML=e;let r=document.createElement("div");r.style.cssText="position:fixed;inset:0;padding:30px;z-index:999999;background:rgba(0,0,0,.7);";let i=document.createElement("iframe");i.style.cssText="width:100%;height:100%;border-radius:5px;",r.appendChild(i),document.body.prepend(r),this.overflow=document.body.style.overflow,document.body.style.overflow="hidden",i.contentWindow.document.open(),i.contentWindow.document.write(t.outerHTML),i.contentWindow.document.close(),r.addEventListener("click",(()=>{r.remove(),document.body.style.overflow=this.overflow})),r.setAttribute("tabindex",0),r.addEventListener("keydown",(e=>{"Escape"===e.key&&(r.remove(),document.body.style.overflow=this.overflow)})),r.focus()}showExpired(){confirm("This page has expired.\nWould you like to refresh the page?")&&location.reload()}refreshAll(){this.components.forEach((e=>{this.refresh(e)}))}refresh(t,r=null,i=null){t.toggleLoads(!1);let n=new FormData;n.append("id",t.id),n.append("name",t.name),n.append("data",JSON.stringify(t.data)),n.append("checksum",t.checksum),n.append("route",t.route),i&&n.append("method",i);for(let e in t.files)Array.from(t.files[e]).forEach((t=>{n.append(e+"[]",t)}));let o=new XMLHttpRequest;o.responseType="text",o.withCredentials=!0,o.open("POST",t.baseUrl+"reactables/update",!0),o.setRequestHeader("X-Reactables",!0),o.upload.onloadstart=()=>{let e=new Event("reactables-upload-start");r&&r.dispatchEvent(e)},o.upload.onprogress=e=>{let t=Math.round(e.loaded/e.total*100),i=new CustomEvent("reactables-upload-progress",{detail:t});r&&r.dispatchEvent(i)},o.upload.onload=()=>{let e=new Event("reactables-upload-success");r&&r.dispatchEvent(e)},o.upload.onerror=()=>{let e=new Event("reactables-upload-failed");r&&r.dispatchEvent(e)},o.onload=()=>{if(200==o.status)try{let r=JSON.parse(o.responseText);if(!r.status)return o.onerror();if(r.redirect)return location.href=r.redirect;morphdom(t.el,r.html,{onNodeAdded:t=>{t.hasAttribute("r:id")&&(window.reactables.components.push(new e(t)),t.skipAddingChildren=!0)},getNodeKey:e=>{let t=e.getAttribute("r:key");return t||e.id},onBeforeElUpdated:(e,t)=>!e.isEqualNode(t)}),t.data=JSON.parse(r.data),t.files={},t.removeAttrs(),t.bind(),t.parseQuery(r.query),t.dispatchEvents(r.events),t.parseNavigateLinks(),t.toggleLoads(),t.removeInits();let i=new Event("reactables-update-success");t.el.dispatchEvent(i)}catch(e){console.error(e),o.onerror()}else 403==o.status?window.reactables.expiredHandler?window.reactables.expiredHandler({status:o.status,body:o.responseText}):window.reactables.showExpired():o.onerror()},o.onerror=()=>{window.reactables.errorHandler?window.reactables.errorHandler({status:o.status,body:o.responseText}):window.reactables.showError(o.responseText)},o.send(n)}navigate(e){let t=new XMLHttpRequest;t.responseType="document",t.withCredentials=!0,t.open("GET",e,!0),t.setRequestHeader("X-Reactables",!0);let r=Array.from(document.head.querySelectorAll("script"));t.onload=()=>{if(200==t.status)try{let i=t.getResponseHeader("X-Reactables-Redirect");if(i)return window.location=i;document.body=t.response.body,t.response.title&&(document.title=t.response.title),history.pushState({},"",e),window.reactables.init(),t.response.head&&t.response.head.querySelectorAll("script").forEach((e=>{if(e.hasAttribute("r:once"))return;if(r.some((t=>t.attributes===e.attributes||t.textContent===e.textContent)))return;let t=document.createElement("script");Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.textContent=e.textContent,document.head.appendChild(t)})),document.body.querySelectorAll("script").forEach((e=>{if(e.hasAttribute("r:once"))return;let t=document.createElement("script");Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.textContent=e.textContent,e.parentNode.replaceChild(t,e)}));let n=new CustomEvent("reactables-navigated");document.dispatchEvent(n)}catch(e){console.error(e),t.onerror()}else t.onerror()},t.onerror=()=>{window.reactables.errorHandler?window.reactables.errorHandler({status:t.status,body:t.response.documentElement.outerHTML}):window.reactables.showError(t.response.documentElement.outerHTML)};let i=new CustomEvent("reactables-navigating");document.dispatchEvent(i),t.send()}},window.Reactables=window.reactables,window.reactables.init())}));